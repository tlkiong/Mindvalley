<!DOCTYPE html>
<html>
  <head>

    <link href="main.css" rel="stylesheet" type="text/css">
  

    <script>
      function appendResults(text) {
        var results = document.getElementById('results');
        results.appendChild(document.createElement('P'));
        results.appendChild(document.createTextNode(text));
      }

      function makeRequest() {
        /*var request = gapi.client.urlshortener.url.get({
          'shortUrl': 'http://goo.gl/fbsS'
        });*/
        
        var request = gapi.client.urlshortener.url.post({
          'longUrl': 'https://kiong-mindvalley.herokuapp.com/'
        });

        request.then(function(response) {
          appendResults(response.result.longUrl);
        }, function(reason) {
          console.log('Error: ' + reason.result.error.message);
        });
      }

      function init() {
        gapi.client.setApiKey('AIzaSyAGRJxbLrB60w6bIUpyLBJz9LazibqhEEw');
        gapi.client.load('urlshortener', 'v1').then(shortenUrl);
      }

      var shortenUrl = function() {
      var request = gapi.client.urlshortener.url.insert({
        resource: {
          longUrl: 'https://kiong-mindvalley.herokuapp.com/'
        }
      });
      request.execute(function(response) {
          var shortUrl = response.id;
          appendResults(response.result.longUrl);
          console.log('short url:', shortUrl);
      });
    };

    var googleApiLoaded = function() {
      // gapi.client.setApiKey("YOUR API KEY")
      gapi.client.load("urlshortener", "v1", shortenUrl);
    };

    window.googleApiLoaded = googleApiLoaded;
    $(document.body).append('<script src="https://apis.google.com/js/client.js?onload=googleApiLoaded"></script>');
    </script>
    <script src="https://apis.google.com/js/client.js?onload=init"></script>
  </head>
  <body>
    <div id="results"></div>
  </body>
</html>